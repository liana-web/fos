<!DOCTYPE html>
<head>
    <title>Add Order (Brochure Style)</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        input[type="date"]::-webkit-calendar-picker-indicator { display: none; -webkit-appearance: none; }
        input[type="date"] { cursor: pointer; }
        .product-card { transition: transform 0.2s; cursor: pointer; }
        .product-card:hover { transform: scale(1.03); }
        .summary-box { background: #f8f9fa; border-radius: 8px; padding: 15px; }
    </style>
</head>
<body class="bg-light">

<div class="container mt-5 mb-5">
    <h2 class="mb-4 text-center">Create New Order</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="alert alert-success text-center">{{ messages[0] }}</div>
      {% endif %}
    {% endwith %}

    <form method="POST">
        <!-- CUSTOMER INFO -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="mb-3 text-primary">Customer Information</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Customer Name</label>
                        <input type="text" name="name" class="form-control" placeholder="Enter customer name" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Email Address</label>
                        <input type="email" name="email" class="form-control" placeholder="Enter email" required>
                    </div>
                </div>
            </div>
        </div>

        <!-- ORDER INFO -->
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="mb-3 text-primary">Order Details</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Order Date</label>
                        <div class="input-group" onclick="document.getElementById('order_date').showPicker()">
                            <input type="date" id="order_date" name="order_date" class="form-control" required>
                            <span class="input-group-text bg-light" style="cursor:pointer;">ðŸ“…</span>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Order Status</label>
                        <select name="order_status" class="form-select" required>
                            <option value="">-- Choose Status --</option>
                            <option value="Pending" selected>Pending</option>
                            <option value="Completed">Completed</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRODUCT BROCHURE -->
        <h4 class="mb-3 text-primary">Select Products</h4>
        <div class="row g-3">
            {% for product in products %}
            <div class="col-md-3">
                <div class="card product-card p-2 text-center">
                    <img src="{{ product[3] }}" class="card-img-top rounded" alt="{{ product[1] }}">
                    <div class="card-body">
                        <h5 class="card-title">{{ product[1] }}</h5>
                        <p class="card-text text-muted">${{ product[2] }}</p>
                        <input type="hidden" name="product_id" value="{{ product[0] }}">
                        <div class="d-flex justify-content-center align-items-center">
                            <input type="number" name="quantity" min="1" value="1" class="form-control w-50 me-2">
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addToOrder('{{ product[0] }}', '{{ product[1] }}', '{{ product[2] }}', this)">Add</button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- ORDER SUMMARY -->
        <div class="mt-5">
            <h4>Order Summary</h4>
            <div id="order-summary" class="summary-box">
                <p class="text-muted">No products added yet.</p>
            </div>
        </div>

        <div class="mt-4 text-center">
            <button type="submit" class="btn btn-primary px-5">Submit Order</button>
        </div>
    </form>
</div>

<script>
function addToOrder(id, name, price, btn) {
    const summary = document.getElementById('order-summary');
    const quantity = btn.parentNode.querySelector('input[name="quantity"]').value;
    const existing = summary.querySelector(`#item-${id}`);

    if (existing) {
        const q = existing.querySelector('.item-qty');
        q.textContent = parseInt(q.textContent) + parseInt(quantity);
    } else {
        const div = document.createElement('div');
        div.id = `item-${id}`;
        div.innerHTML = `<strong>${name}</strong> - ${quantity} Ã— $${price} <span class="item-qty">${quantity}</span>`;
        summary.appendChild(div);
    }

    summary.querySelector('.text-muted')?.remove();
}
</script>

</body>
</html>
