{% extends "base.html" %}
{% block content %}
<div class="container mt-5 mb-5">
  <h1 style="text-align: center; color: #fff;" class="mb-4">Create New Order</h1>
  <form method="POST" class="card" id="orderForm">
    <div class="mb-3">
        <label class="form-label">Order Date</label>
        <div class="input-group" onclick="document.getElementById('order_date').showPicker()">
            <input style="background: #fff;" type="date" id="order_date" name="order_date" class="form-control" required>
        </div>
    </div>

    <div class="mb-3">
      <label for="order_status" class="form-label">Order Status</label>
      <select name="order_status" id="order_status" class="form-select">
        <option value="Pending">Pending</option>
        <option value="Completed">Completed</option>
        <option value="Cancelled">Cancelled</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="customer_id" class="form-label">Customer <span class="text-danger">*</span></label>
      <select id="customer_id" name="customer_id" class="form-select" onchange="toggleNewCustomer()" required>
          <option value="" disabled selected>-- Select Existing Customer --</option>
          {% for customer in customers %}
          <option value="{{ customer[0] }}">{{ customer[3] }}</option>
          {% endfor %}
      </select>
    </div>

    <h5 class="mt-4">Select Products</h5>

    <div class="menu-grid-container">
      {% for product in products %}
        <div class="menu-item">
          <div class="item-header">
            <img src="{{ url_for('static', filename='img/' + product[4]) }}" alt="{{ product[1] }}">
            <button class="favorite-btn"><i class="fa-regular fa-heart"></i></button>
          </div>
          <div class="item-body">
            <div class="rating green-stars">
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star"></i><i class="fas fa-star"></i>
              <i class="fas fa-star"></i>
            </div>
            <h3>{{ product[1] }}</h3>
            <p class="description">
              {{ product[2] }}
            </p>            
            <div class="item-footer">
              <span class="price">â‚±{{ "%.2f"|format(product[3]) }}</span>
            </div>
            <div class="input-group">
              <input type="hidden" name="product_id[]" value="{{ product[0] }}">
              <input type="number" name="quantity[]" min="0" value="0" class="form-control" placeholder="Qty">
            </div>
          </div>
        </div> 
      {% endfor %}
    </div>
    <center>
      <button type="submit" class="btn btn-primary mt-3">Submit Order</button>
    </center>
  </form>
</div>
<script>
  const form = document.getElementById("orderForm");
  form.addEventListener("submit", function(event) {
    // Get all quantity inputs
    const quantities = form.querySelectorAll('input[name="quantity[]"]');
    
    // Check if at least one has value > 0
    let valid = false;
    quantities.forEach(qty => {
      if (parseInt(qty.value) > 0) valid = true;
    });

    if (!valid) {
      alert("Please select at least one product with quantity greater than 0.");
      event.preventDefault(); // Stop form submission
    }
  });
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
